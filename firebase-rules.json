{
  "rules": {
    ".read": true,
    ".write": false,
    "status" : {
      "$user_id" : { 
        ".write" : "auth.id == $userId"
      }
    },
    "auction" : {
      ".write" : true
    },
    "chat" : {
        ".read": false,
        ".write": false,
        "channels" : {
            ".read": true,
            "$channelId" : {
                // Append-only by anyone, and admins can add official channels, and edit or remove channels as well.
                ".write": "(auth != null) && (!data.exists() || root.child('chat').child('users').hasChild(auth.id).child('isModerator').val() == true || data.child('createdByUserId').val() === auth.id)",
                ".validate": "newData.hasChildren(['name','type'])",
                "id": {
                  ".validate": "(newData.val() === $channelId)"
                },
                "createdByUserId": {
                  ".validate": "(auth.id === newData.val())"
                },
                "type": {
                  ".validate": "('public' === newData.val()) || 'private' === newData.val() || ('official' === newData.val() && (root.child('moderators').hasChild(auth.id)))"
                },
                // A list of users that may read messages from this channel.
                "authorizedUsers": {
                  ".write": "(auth != null) && (!data.exists() || root.child('chat').child('users').hasChild(auth.id).child('isModerator').val() == true || data.hasChild(auth.id))"
                },
                "messages" : {   // A list of messages in this channel, viewable by anyone for public channels, or authorized users for private channels.
                    ".read": "(root.child('chat').child('channels').child($channelId).child('type').val() != 'private' || root.child('chat').child('channels').child($channelId).child('authorizedUsers').hasChild(auth.id))",
                        "$messageId": {
                          // Allow anyone to append to this list and allow admins to edit or remove.
                          ".write": "(auth != null) && (data.val() === null || root.child('chat').child('users').hasChild(auth.id).child('isModerator').val() == true && (root.child('chat').child('channels').child($channelId).child('type').val() != 'private' || root.child('chat').child('channels').child($channelId).child('authorizedUsers').hasChild(auth.id)) && (!root.child('suspensions').hasChild(auth.id) || root.child('suspensions').child(auth.id).val() < now)",
                          ".validate": "(newData.hasChildren(['userId','name','message','timestamp']))"
                        }
                    }
                }
            }
        }
    }
  }
}